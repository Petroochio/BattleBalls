<!doctype html>
<html>
    <head>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1">
        <title>Battle Balls</title>
        <style>
            @font-face {
                font-family: BAAAAALLLLLLLLLLS;
                src: url("assets/fonts/marqueemoon.ttf");
            }
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font: 13px BAAAAALLLLLLLLLLS, Arial; background: #000;}
            form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
            form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
            form button { width: 8%; background: rgb(130, 224, 255); border: none; padding: 10px; user-select: none; -webkit-user-select: none;}
            #myCanvas { user-select: none; -webkit-user-select: none; }
            #start {position: absolute;}
            #button1 {user-select: none; visibility: hidden;}
            #button2 {user-select: none; visibility: hidden;}
            #buttons { width: 200px; margin: 0 auto; user-select: none; -webkit-user-select: none; /*visibility: hidden;*/}
        </style>
        <script src="/socket.io/socket.io.js"></script>
        <script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
        <script src="js/controller.js"></script>
        <script src="js/button.js"></script>
        <script> window.onload = function() { game.controller.init(); };</script>
        <!--<script>
            var screenState = "START";
            var boomButton, dashButton, startCanvas;
            var boomCTX, dashCTX, startCTX;
            var color;
            var ready = false;
            
            /*var Button = function(ctx,type,x,y,radius,col){
                this.ctx = ctx;
                this.type = type;
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = col;
                this.pressed = false;
            };*/

            window.onload = init;

            function init(){
                // create new instance of socket.io
                var num = Math.floor(Math.random()*10);
                var name ='user'+num;
                var id = -1;

                var red = Math.floor(Math.random() * 105 +150);
                var green = Math.floor(Math.random() * 105 +150);
                var blue = Math.floor(Math.random() * 105 +150);
                color = 'rgb('+red+','+green+','+blue+')';
                //setting client's own properties (MIGHT NOT BE THE BEST PRACTICE);
                var socket = io.connect( window.location.origin, {query: 'user='+name});

                var connectData = { id: id, color: color };

                socket.emit('player join', connectData);

                socket.on('player connect', function(data){
                    if(data.id !== -1) {
                        id = data.id;
                    }
                });

                socket.on('state change', function(data){
                    //temp code until I talk to you
                    if(data.state === "END") {
                        screenState = "START";
                        startCanvas.style.display = "block";
                        boomButton.style.visibility = "hidden";
                        dashButton.style.visibility = "hidden";
                    }else if(data.state === "GAME") {
                        screenState = "GAME";
                        startCanvas.style.display = "none";
                        boomButton.style.visibility = "visible";
                        dashButton.style.visibility = "visible";
                        ready = false;
                    }
                });

                //initialize start screen
                startCanvas = document.querySelector("#start");
                if(startCanvas.getContext) startCTX = startCanvas.getContext("2d");
                startCTX.fillStyle = color;

                //Event listener
                startCanvas.addEventListener("touchend", function(e){
                    socket.emit('player ready', {id : id});
                    ready = !ready;
                });

                //initialize Boom Button
                var boomButton = document.querySelector("#button1");
                var boomCTX;
                if (boomButton.getContext) boomCTX = boomButton.getContext("2d");

                //Event listeners
                boomButton.addEventListener("touchstart", function(e){
                    var data = { id: id, type: "boom" };
                    socket.emit('charge start', data);
                    redraw(boomButton, "BOOM",boomCTX);
                }, false);
                boomButton.addEventListener("touchend", function(e){
                    var data = { id: id };
                    socket.emit('charge end', data);
                    draw(boomButton, "BOOM",boomCTX);
                }, false);
                draw(boomButton, "BOOM",boomCTX);

                //initialize Dash Button
                var dashButton = document.querySelector("#button2");
                var dashCTX;
                if (dashButton.getContext) dashCTX = dashButton.getContext("2d");
                  
                //Event listeners
                dashButton.addEventListener("touchstart", function(e){
                    //hello peter
                    var data = { id: id, type: "dash" };
                    socket.emit('charge start', data);
                    redraw(dashButton, "DASH",dashCTX);
                }, false);
                dashButton.addEventListener("touchend", function(e){
                    //hello peter
                    var data = { id: id };
                    socket.emit('charge end', data);
                    draw(dashButton, "DASH",dashCTX);
                }, false);
                draw(dashButton, "DASH",dashCTX);

                if (window.DeviceOrientationEvent) {
                    window.addEventListener('deviceorientation', function(e) {
                        // gamma is the left-to-right tilt in degrees, where right is positive
                        var xTilt = e.gamma;
                        // beta is the front-to-back tilt in degrees, where front is positive
                        var yTilt = e.beta;
                        // alpha is the compass direction the device is facing in degrees
                        var rot = e.alpha

                        var data = { id: id, xAcc : xTilt, yAcc : yTilt };
                        socket.emit('phone tilt', data);
                    }, false);
                }

                loop();
            };

            function loop(){
                requestAnimationFrame(update);
            }

            function updateStartMenu() {
                startCTX.rotate(Math.PI/2);
                startCTX.translate(startCanvas.width/2,-300);
                
                startCTX.clearRect(0,0,startCanvas.width,startCanvas.height);
                startCTX.font = '50px BAAAAALLLLLLLLLLS';
                startCTX.textAlign = "center";
                startCTX.textBaseline = "middle";
                if(ready){
                    startCTX.save();
                    startCTX.shadowBlur = 10;
                    startCTX.shadowColor = color;
                    startCTX.fillText("UNREADY",startCanvas.width/2,startCanvas.height/2);
                    startCTX.restore();
                } else {
                    startCTX.fillText("READY",startCanvas.width/2,startCanvas.height/2);
                }
            }

            function updateGameLoop() {
            }

            function update() {
                switch(screenState) {
                    case "START":
                        updateStartMenu();
                        break;
                    case "GAME":
                        updateGameLoop();
                        break;
                }
            }

            function draw(canvas, butt, ctx) {
                ctx.save();
                ctx.clearRect(0,0,canvas.width,canvas.height);
                ctx.translate(canvas.width,canvas.height/64);
                ctx.rotate(Math.PI/2);
                ctx.strokeStyle = color;
                ctx.fillStyle = color;
                ctx.shadowColor = color;
                ctx.lineWidth = 5;
                ctx.shadowBlur = 10;
                ctx.beginPath();
                ctx.arc(canvas.width/2,canvas.height/2,canvas.width/2-10,0,Math.PI*2,false);
                ctx.closePath();
                ctx.stroke();

                ctx.font = '60px BAAAAALLLLLLLLLLS';
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(butt,canvas.width/2,canvas.height/2);
                ctx.restore();
            };

            function redraw(canvas, butt, ctx) {
                ctx.save();
                ctx.clearRect(0,0,canvas.width,canvas.height);
                ctx.translate(canvas.width,canvas.height/64);
                ctx.rotate(Math.PI/2);
                ctx.strokeStyle = color;
                ctx.fillStyle = color;
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.arc(canvas.width/2,canvas.height/2,canvas.width/2-50,0,Math.PI*2,false);
                ctx.closePath();
                ctx.stroke();

                ctx.font = '40px BAAAAALLLLLLLLLLS';
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(butt,canvas.width/2,canvas.height/2);
                ctx.restore();
            };
        </script> -->
    </head>
    <body>
        <div id="wrapper" width="100%" height="100%">
            <canvas id="myCanvas"></canvas>
        </div>
        <!-- <div id="buttons">
            <canvas id="start" width="200px"height="400px"></canvas>
            <canvas id="button1"width="200px"height="200px"></canvas>
            <br>
            <canvas id="button2"width="200px"height="200px"></canvas>
        </div> -->
    </body>
</html>
